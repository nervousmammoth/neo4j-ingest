---
**Status:** Done
**Priority:** P1-MVP (Critical)
**Branch:** `feature/P1.3-docker-setup`
---

## Overview

Create a multi-stage Dockerfile for the Next.js application and a `docker-compose.yml` for local orchestration with MinIO for S3-compatible storage.

---

## User Stories

**As a** developer
**I want** to containerize the application with Docker and set up MinIO for local S3 storage
**So that** the application can be deployed consistently across development and production environments

**As a** developer
**I want** to use MinIO in development
**So that** I can test S3 functionality without needing access to production infrastructure

---

## Requirements

- Multi-stage Dockerfile (builder vs runner) to optimize image size
- `docker-compose.yml` with MinIO service for local development
- Ensure it works with the planned Caddy proxy

---

## Implementation Steps

### Commit 1: `feat: Create multi-stage Dockerfile`

```dockerfile
# Builder stage
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Runner stage
FROM node:20-alpine AS runner
WORKDIR /app
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
COPY --from=builder /app/public ./public
EXPOSE 3000
CMD ["node", "server.js"]
```

### Commit 2: `feat: Create docker-compose.yml with MinIO`

```yaml
version: '3.8'

services:
  minio:
    image: minio/minio:latest
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data

  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      AWS_REGION: us-east-1
      AWS_ACCESS_KEY_ID: minioadmin
      AWS_SECRET_ACCESS_KEY: minioadmin
      AWS_ENDPOINT_URL: http://minio:9000
      S3_BUCKET_NAME: csv-ingest
      S3_FORCE_PATH_STYLE: "true"
    depends_on:
      - minio

volumes:
  minio_data:
```

---

## Acceptance Criteria

- [x] Docker build succeeds
- [x] Docker container runs and serves the application
- [x] Image size is optimized (using standalone output) - 292MB
- [x] MinIO is accessible at http://localhost:9001
- [x] Application can connect to MinIO S3 API

---

## Dependencies

- P1.1 Init Project

## Blocking

- P2.1 S3 Client
- P5.2 Env Vars (production deployment)

---
**Status:** To Do
**Priority:** P5 (Low)
**Branch:** `feature/P5.2-env-vars`
---

## Overview

Configure production environment variables and secrets management for VMware Aria Automation deployment.

---

## User Stories

**As a** system administrator
**I want** to configure production S3 credentials securely
**So that** the application can connect to VMware Aria S3 without exposing secrets in code or logs

**As a** developer
**I want** to document all required environment variables
**So that** deployment teams know exactly what configuration is needed

**As a** security engineer
**I want** credentials stored in Docker secrets
**So that** sensitive data is protected and not visible in container configurations

---

## Requirements

- Configure all required environment variables for production
- Secure storage of secrets (Docker secrets or environment injection)
- Document variable requirements

---

## Environment Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `AWS_ACCESS_KEY_ID` | S3 access key | `AKIA...` |
| `AWS_SECRET_ACCESS_KEY` | S3 secret key | `wJal...` |
| `AWS_REGION` | S3 region | `us-east-1` |
| `S3_BUCKET_NAME` | Target bucket | `csv-ingest` |
| `AWS_ENDPOINT_URL` | S3 endpoint (for non-AWS) | `https://s3.corp.local` |
| `S3_FORCE_PATH_STYLE` | Path style (MinIO only) | `false` |

---

## Implementation Steps

### Step 1: Create `.env.example` template

Document all required variables without sensitive values.

### Step 2: Configure Docker secrets

For production, use Docker secrets:

```yaml
services:
  app:
    secrets:
      - aws_access_key
      - aws_secret_key
    environment:
      AWS_ACCESS_KEY_ID_FILE: /run/secrets/aws_access_key
      AWS_SECRET_ACCESS_KEY_FILE: /run/secrets/aws_secret_key

secrets:
  aws_access_key:
    external: true
  aws_secret_key:
    external: true
```

### Step 3: Update S3 client to read from secrets

Modify `lib/s3.ts` to support reading from `_FILE` environment variables.

---

## Acceptance Criteria

- [ ] App reads env vars correctly in production mode
- [ ] Secrets are not exposed in Docker image or logs
- [ ] `.env.example` documents all required variables
- [ ] Deployment documentation is updated

---

## Dependencies

- P1.3 Docker Setup

## Blocking

- P5.3 Load Test

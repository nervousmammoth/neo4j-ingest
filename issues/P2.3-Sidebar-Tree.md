---
**Status:** To Do
**Priority:** P1-MVP (Critical)
**Branch:** `feature/P2.3-sidebar-tree`
---

## Overview

Implement the sidebar navigation using a recursive tree structure that lazy-loads folder contents from S3. Built on shadcn/ui sidebar-11 layout.

---

## User Stories

**As a** user
**I want** to browse my S3 folders in an expandable tree view
**So that** I can quickly navigate deep folder structures without loading unnecessary data

**As a** user
**I want** the tree to load folders on-demand when I expand them
**So that** the interface remains fast even with thousands of folders

---

## Requirements

- Use `shadcn/ui` Sidebar component (sidebar-11 pattern)
- Fetch data from `/api/s3/list`
- Lazy load sub-folders on expansion
- Use TanStack Query for data fetching and caching
- Visualize the folder hierarchy with expand/collapse icons

---

## Implementation Steps

### Commit 1: `feat: Set up TanStack Query provider`

Configure React Query provider in app layout.

### Commit 2: `feat: Create folder tree hook`

```typescript
// hooks/use-folder-tree.ts
import { useQuery } from '@tanstack/react-query';

export function useFolderTree(prefix: string) {
  return useQuery({
    queryKey: ['s3-list', prefix],
    queryFn: async () => {
      const res = await fetch(`/api/s3/list?prefix=${encodeURIComponent(prefix)}`);
      if (!res.ok) throw new Error('Failed to fetch');
      return res.json();
    },
    staleTime: 30000, // Cache for 30 seconds
  });
}
```

### Commit 3: `feat: Create recursive SidebarTree component`

Build recursive tree component that:
- Shows loading state while fetching
- Expands to load children on click
- Highlights selected folder

---

## Acceptance Criteria

- [ ] Sidebar displays top-level folders from S3
- [ ] Expanding a folder fetches and displays sub-folders
- [ ] Selection state is maintained across navigation
- [ ] Loading states shown during fetch
- [ ] Tree supports 10,000+ items with virtualization

---

## Dependencies

- P1.2 Install shadcn/ui
- P2.2 List Endpoint

## Blocking

- P2.4 File Grid (needs folder selection)
